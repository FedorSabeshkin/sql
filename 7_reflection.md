

1. Я писал скрипт без деталей предметной области, вроде навыков, которые стоит учитывать для битв.

Например, неучтены ничьи в сражениях, а только победы и поражения.

2. Причиной выхода учитывал смерть по той или иной причине, поэтому смертность смотрел по самой даде выхода, без дополнительной проверки.

3. \+ total_battles - верно  
\+ victories     
\+ victory_percentage  

4. retention_rate у меня расчитан по формуле из маркетинга, с учетом периода начала и конца, более точно :).

5. GROUP BY сформировал верно, указав все колонки из SELECT, кроме тех, что считаются агрегатными функциями

6. \- casualties_rate - не выполнил SUM casualties по всем битвам. 
Даже с учетом, что высчитывал это для конкретной даты битвы.

\- casualty_exchange_ratio - так же не выполнил SUM
Интересно, что здесь в отношении побежденных врагов и проигравших своих в casualty_exchange_ratioя NULLIF идет сравнение с 1, что бы не получилось что деление равно числитилю

\- avg_equipment_quality - я использовал более сложную формулу с умножение качества на кол-во, т.к. если много слабой экипировки, то в среднем она будет не очень, даже если есть одна хорошая.
В случае если id уникальный, на что указывает необходимость создания поля quantity. Хотя возможно оно обновляется агрегатной функцией по тригеру.

\+ current_members - Расчитанно верно! Как раз по условию, что причина выхода null.

\+ total_members_ever - верно

\+ total_training_sessions

\+ avg_training_effectiveness


\- training_battle_correlation - НЕВЕРНО. 
Я передаю просто два скаляра, по которым не вычислится зависимость. 

В примере верно передается эффективность конкретной тренировки и конкретная победа (а не сумма ВСЕХ побед (одно число) и сумма ВСЕХ тренировок (второе число))

Корреляцию стоит вычислять передавая векторы, а не скаляры.

\- avg_skill_improvement 
а) Для получения текущего и начального уровня использовал часть запроса с прошлого задания и оно не имело смысла, т.к. ссылалось на данные из таблицы, которой нет в запросе... Надо было пересмотреть. 
? как сейчас берется начальный уровень? Не надо взять минимальное время?

Да, есть условие, берутся для начала навыки у которых дата появления меньше или равна дате добавления в отряд дварфа
б) верно использовал идею разности текущего и прошлого уровня умений. 
Но я их плюсовал, а тут просто оставляют как есть, что верно? НЕТ Там же по ряду навыков, для которого я конечно WHERE не задавал, т.к. многое может прокачаться в походах.
в) В оригинале НЕ учтено, что надо брать максимальную дату до или равную дате вступления в отряд, что бы обработать случай, когда есть несколько записей по одному навыку до вступления в отряд.

JOIN с dwarfes не требовался, т.к. dwarf_id уже в таблице навыков и дварфов был.

7. Я стараюсь каждое поле требующее вычисления выводить во временную таблицу с понятным названием, что бы логика в ней была простая.

8. Прием с вычислением общего рейтинга был верен.
